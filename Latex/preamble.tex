% \linespread{1.25}
\usepackage[utf8]{inputenc}
\usepackage{babel,duomasterforside} % English language/hyphenation

% ******** text can be aligned *********************************
\usepackage{ragged2e}
% flushleft: left-alignment
% flushright: right-alignment



\usepackage[T1]{fontenc}
\usepackage{fourier}

\usepackage{floatflt}
\usepackage[verbose]{placeins}
\usepackage{wrapfig}
\usepackage[a4paper,lmargin={3cm},rmargin={2cm},tmargin={2.5cm},bmargin = {2.5cm}]{geometry}
%\usepackage[width={160mm},top={30cm},bottom={30mm},headheight={15pt}]{geometry}
\usepackage[protrusion=true,expansion=true]{microtype}
\usepackage{amsmath,amsfonts,amsthm} % Math packages
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{commath}
%\usepackage[pdftex]{graphicx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\setlength{\headheight}{14pt}

% ****** References and links in color and linked ********************
\usepackage[breaklinks=true,hidelinks]{hyperref}
%
\usepackage{apptools,etoolbox}
\appto\UrlBreaks{\do\-}
\usepackage{xcolor}
%\hypersetup{
%	colorlinks,
%	linkcolor={red!50!black},
%	citecolor={blue!50!black},
%	urlcolor={blue!80!black}}

% ******** Citation **************************************************
\usepackage{cite}
\usepackage[authoryear,square,comma,sort&compress]{natbib} % citation style


% ****** make fig, table caption in linkcolor **************
%\usepackage[figurename=Fig.,tablename=Tab.]{caption}
\usepackage[figurename=Figure,tablename=Table]{caption}
%\DeclareCaptionFont{red}{\color{red!50!black}}
\captionsetup{labelfont=bf,
    font=small}
\makeatletter
%\renewcommand{\fnum@figure}{Fig. \thefigure}


\makeatother

\usepackage{subcaption}
% ******* reference with Fig. before number of Fig. ********
\usepackage{cleveref}
\crefrangelabelformat{equation}%
{(#3#1#4--#5\crefstripprefix{#1}{#2}#6)}
\crefrangelabelformat{subequation}%
{(#3#1#4--#5\crefstripprefix{#1}{#2}#6)}

\crefmultiformat{figure}%
{\edef\crefstripprefixinfo{#1}figs.~#2#1#3}%
{ and~#2\crefstripprefix{\crefstripprefixinfo}{#1}#3}%
{, #2\crefstripprefix{\crefstripprefixinfo}{#1}#3}%
{, and~#2\crefstripprefix{\crefstripprefixinfo}{#1}#3}
% \Crefname{equation}{Eq.}{Eqs.}
% \Crefname{figure}{Fig.}{Figs.}
% \Crefname{tabular}{Tab.}{Tabs.}
% \Crefname{section}{Sec.}{Secs.}



%%%%%%%%%%%

\usepackage{sidecap}
\usepackage{float}
\usepackage{gensymb}
\usepackage{placeins}
\usepackage{abstract}
%\usepackage[page,toc,titletoc,title]{appendix}
%\usepackage[toc,title]{appendix}   % include 'page' and get extra page for Appendices
\usepackage{color}




% ******* line numbering every 5th line ********
\usepackage[modulo]{lineno}


% ******** upper case chapter names in ToC ************************
\usepackage{tocloft}
\renewcommand{\cftchapfont}{\scshape}


% ******** upper case ToC, LoF, LoT, Nomenclature, and renaming ****
% Table of Contents
\renewcommand{\cfttoctitlefont}{\hfill\normalfont\huge\scshape}
\renewcommand{\cftaftertoctitle}{\hfill}

% List of Figures
\renewcommand{\cftloftitlefont}{\hfill\normalfont\huge\scshape}
\renewcommand{\cftafterloftitle}{\hfill}

% List of Tables
\renewcommand{\cftlottitlefont}{\hfill\normalfont\huge\scshape}
\renewcommand{\cftafterlottitle}{\hfill}

% ********* Nomenclature **************************************

\usepackage{nomencl}
\renewcommand{\nomname}{List of Abbreviations}
\makenomenclature
\renewcommand{\nomlabel}[1]{{\textbf{#1}}} %bold 



% % ********* Write Appendix instead of Chapter in ToC ***********
\usepackage{titletoc}%
\usepackage{sectsty}
\usepackage{titlesec}
\usepackage{tocloft,calc}  	% the tocloft package lets you redefine the Table of Contents (ToC)

\newcommand{\cftchapterdotsep}{\cftnodots}
\renewcommand{\cftchapterdotsep}{\cftdotsep}% Chapters should use dots in ToC

% ***** CHAPTER in ToC *************
\titlecontents{chapter}% <section-type>
[0pt]% <left>
{\scshape\bfseries}% <above-code>
{\chaptername\ \thecontentslabel:\quad}% <numbered-entry-format>
{}% <numberless-entry-format>
{\hfill\contentspage}% <filler-page-format>

\makeatletter
\newcommand\appendix@chapter[1]{%
    \refstepcounter{chapter}%
    \def\app@ct{Appendix \@Alph\c@chapter:\quad#1}
    \orig@chapter*{\app@ct}%
    \markboth{\MakeUppercase{\app@ct}}{\MakeUppercase{\app@ct}}
    \addcontentsline{toc}{chapter}{\app@ct}%
}
\let\orig@chapter\chapter
\g@addto@macro\appendix{\let\chapter\appendix@chapter}
\makeatother


% \makeatletter
% \patchcmd{\@chapter}{\protect {CHAPTER }}{\ifappendix{APPENDIX }\else{CHAPTER }\fi}{}{}
% \makeatother

% 


% ******* Custom sectioning and chapter font **********************

\allsectionsfont{\centering \normalfont\scshape}
\titleformat{\chapter}[hang]
{\centering\normalfont\huge\scshape}{\chaptertitlename\ \thechapter:}{1em}{} % That it makes Chapter1: Introduction
\titleformat{\section}
{\centering\normalfont\Large\scshape}{\thesection}{1em}{}

\renewcommand{\abstractnamefont}{\centering\normalfont\huge\scshape}
\newcommand*\NewPage{\newpage\null\thispagestyle{empty}\newpage}


% ********* horizontal layout margins *******
\setlength{\oddsidemargin}{0.2in}
\setlength{\evensidemargin}{0.0in}
\setlength{\textwidth}{\paperwidth - 2.2in}
\setlength{\topsep}{0.3cm}  % distance before and after a list

% ******* Custom headers/footers (fancyhdr package)
\usepackage{fancyhdr}
\pagestyle{fancyplain}


%\renewcommand{\headrulewidth}{2pt}			% header underlines
%\renewcommand{\footrulewidth}{1pt}			% footer underlines


% these lengths will control the headrule trimming to the left and right 
\newlength\FHleft
\newlength\FHright
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\rightmark}
%\fancyfoot[LE,RO]{\thepage}
\fancyhead[RO]{\leftmark}
\fancyhead[RE,LO]{\textbf{\thepage}}
\fancypagestyle{plain}{\fancyhead{}\renewcommand{\headrulewidth}{0pt}} %removes the header from the first chapter page

% **** For instance, \fancyhead[LE,RO]{Share\LaTeX} will print the text "ShareLaTeX" on the Left side of the header for Even pages, and the Right side for Odd pages.

%\thechapter adds number of the current chapter.

%\thesection adds number of the current section.

% \chaptername adds the word "Chapter" in English or its equivalent in the current language.

% \leftmark adds name and number of the current top-level structure (for example, Chapter for reports and books classes; Section for articles ) in uppercase letters.

% \rightmark adds name and number of the current next to top-level structure (Section for reports and books; Subsection for articles) in uppercase letters.

% \thepage adds number of the current page.



% ********* New environments  in the form of Abstract**************
% Declaration  
\newcommand\decName{declaration}
\newenvironment{declaration}
{\renewcommand\abstractname{\decName}\begin{abstract}}
        {\end{abstract}}

% Acknowledgment
\newcommand\ackName{acknowledgement}
\newenvironment{acknowledgement}
{\renewcommand\abstractname{\ackName}\begin{abstract}}
        {\end{abstract}}

% ********* Equation and float numbering ****************************
\numberwithin{equation}{section}		% Equationnumbering: section.eq#
\numberwithin{figure}{section}			% Figurenumbering: section.fig#
\numberwithin{table}{section}				% Tablenumbering: section.tab#


% ***** numbers and units *****
% https://www.dpg-physik.de/dpg/gliederung/junge/rg/wuerzburg/Archiv/WS%202011-12/LaTeX/siunitx.pdf
\usepackage{siunitx}
\DeclareSIUnit\mPs{\m\per\s}
\DeclareSIUnit\UTC{\,UTC}
\DeclareSIUnit\IVT{\kg\per\m\per\s}
\DeclareSIUnit\hPa{\hecto\pascal}
\DeclareSIUnit\dec{\>December\;2016}
\DeclareSIUnit\SWC{\gram\per\cubic\metre}
\DeclareSIUnit\SWP{\gram\per\square\metre}




% ********** landscape mode ****************
% lscape.sty Produce landscape pages in a (mainly) portrait document.
\usepackage{lscape}



% ********** automatically link DOI's ****************
\newcommand*{\doi}[1]{\href{http://dx.doi.org/\detokenize{#1}}{doi: \detokenize{#1}}}

% ********** include part only in toc ****************
%\addto\captionsLANGUAGE{\renewcommand{\partname}{}
%%\renewcommand{\chaptername}{}} 
%\renewcommand{\thepart}{}

\NewDocumentCommand{\TOCpart}{s m}{%
    \clearpage
    \stepcounter{part}%
    \addtocontents{toc}{%
        \protect\contentsline{part}% type
        {\protect\numberline{\thepart} #2}% number + title
        {\number\numexpr\value{page}+1}% page number
        {chapter.%\number
            \numexpr\value{chapter}+1}}% hyperref link
    \cleardoublepage
    \ignorespaces
}

% ******* Adjusting the space between references in the bibliography. **********
\newlength{\bibitemsep}\setlength{\bibitemsep}{.02\baselineskip plus .05\baselineskip minus .05\baselineskip}
\newlength{\bibparskip}\setlength{\bibparskip}{0pt}
\let\oldthebibliography\thebibliography
\renewcommand\thebibliography[1]{%
    \oldthebibliography{#1}%
    \setlength{\parskip}{\bibitemsep}%
    \setlength{\itemsep}{\bibparskip}%
}
% ******** If subfigure reaches 'Z' *************** 
\usepackage{alphalph}
\renewcommand*{\thesubfigure}{%
    \alphalph{\value{subfigure}}%
}%


% ******** specify the line spacing for all sections and paragraphs until another command is used *************
\usepackage{setspace}